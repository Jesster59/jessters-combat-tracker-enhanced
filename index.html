<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Jesster's Combat Tracker - A comprehensive combat tracker for tabletop role-playing games">
    <meta name="theme-color" content="#3f51b5">
    <title>Jesster's Combat Tracker</title>
    
    <!-- Favicon -->
    <link rel="icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/icon-192x192.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono&display=swap" rel="stylesheet">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/tactical.css">
    <link rel="stylesheet" href="css/themes.css">
    
    <!-- PWA support -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Preload critical JavaScript -->
    <link rel="preload" href="js/app.js" as="script" crossorigin="anonymous">
    <link rel="preload" href="js/ui.js" as="script" crossorigin="anonymous">
</head>
<body>
    <!-- App loading screen -->
    <div id="loading-screen">
        <div class="loading-container">
            <div class="loading-logo">
                <img src="images/logo.svg" alt="Jesster's Combat Tracker Logo">
            </div>
            <h1>Jesster's Combat Tracker</h1>
            <div class="loading-spinner"></div>
            <p>Loading application...</p>
        </div>
    </div>
    
    <!-- Main application container -->
    <div id="jct-app" class="jct-app"></div>
    
    <!-- Error message for unsupported browsers -->
    <div id="browser-error" style="display: none;">
        <div class="error-container">
            <h2>Browser Not Supported</h2>
            <p>Your browser doesn't support all the features needed to run Jesster's Combat Tracker.</p>
            <p>Please use a modern browser like Chrome, Firefox, Safari, or Edge.</p>
        </div>
    </div>
    
    <!-- Browser compatibility check -->
    <script>
        // Check for required browser features
        const isCompatible = (
            'localStorage' in window &&
            'Promise' in window &&
            'fetch' in window &&
            'Map' in window &&
            'HTMLCanvasElement' in window
        );
        
        if (!isCompatible) {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('browser-error').style.display = 'block';
        }
    </script>
    
    <!-- Application scripts -->
    <script type="module">
        import { createCombatTrackerApp } from './js/app.js';
        
        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize the application
            const app = createCombatTrackerApp({
                containerId: 'jct-app',
                storageKey: 'jct-data',
                autoSave: true,
                autoSaveInterval: 60000, // 1 minute
                defaultTheme: 'system'
            });
            
            // Hide loading screen when app is initialized
            app.addEventListener('initialized', () => {
                const loadingScreen = document.getElementById('loading-screen');
                loadingScreen.classList.add('fade-out');
                
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            });
            
            // Make app available globally for debugging
            window.jctApp = app;
        });
        
        // Register service worker for offline support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
    </script>
    
    <!-- Fallback for older browsers -->
    <script nomodule>
        document.getElementById('loading-screen').style.display = 'none';
        document.getElementById('browser-error').style.display = 'block';
    </script>
</body>
</html>

